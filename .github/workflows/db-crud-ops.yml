name: db_crud_ops
on: 
  push:
    branches:
      - 'main'
jobs:
  xqerl-cli-crud-ops:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v2
        with:
          fetch-depth: 1
      - name: Set up local bin
        run: |
          mkdir -p $HOME/.local/bin
          echo "$HOME/.local/bin" >> $GITHUB_PATH
          pushd $HOME/.local/bin && ln -s ${GITHUB_WORKSPACE}/bin/xq && popd
          which xq
      - name: Github login in and pull helper github packages
        run: |
          echo ${{ secrets.GITHUB_TOKEN }} | docker login docker.pkg.github.com --username ${GITHUB_ACTOR} --password-stdin &> /dev/null
          make pull
          echo -n ' - check available: '
          docker images | grep -oP 'alpine-zopfli'
      - name: Start running xqerl in a container
        run: |
          printf %60s | tr ' ' '-' && echo
          echo '> make'
          make up
          printf %60s | tr ' ' '-' && echo
      - name: about xqerl database CRUD ops
        run: |
          echo ' - `xq put {domain-path}` will store a data source as a db *XDM item*'
          echo ' - from file put XDM item into db' 
          echo ' - all *data* sources are located in the "./src/data/" directory'
          echo ' -  param {domain-path} is the path from "./src/data"'
          echo ' - a "domain" must be included the {domain-path),'
          echo ' - like "example.com/path-to-resource.xml" or "src/data/example.com/examples/employees.xml"'
      - name:  put JSON documents into db as array or map items
        run: |
          echo ' - from example.com/examples/colors.json put into db a map(*) item'
          echo '> xq put example.com/examples/colors.json'
          xq put example.com/examples/colors.json
          printf %60s | tr ' ' '-' && echo
          echo ' - from example.com/examples/mildred.json put into db a map(*) item'
          echo '> xq put example.com/examples/mildred.json'
          xq put example.com/examples/mildred.json
          printf %60s | tr ' ' '-' && echo
        run: |
          echo ' - from example.com/content/index.md put into db a XML document-node() item '
          echo '> xq put example.com/content/index.md'
          xq put example.com/content/index.md
          printf %60s | tr ' ' '=' && echo
      - name: Stop running xqerl
        run: | 
          make down
          printf %60s | tr ' ' '-' && echo
