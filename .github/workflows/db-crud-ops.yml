name: db_crud_ops
on: 
  push:
    branches:
      - 'xq-update'
jobs:
  xqerl-cli-crud-ops:
    runs-on: ubuntu-latest
    steps:
    - uses: hmarr/debug-action@v2
      - name: Checkout Repo
        uses: actions/checkout@v2
        with:
          fetch-depth: 1
      - name: Github login in and pull helper github packages
        run: |
          echo ${{ secrets.GITHUB_TOKEN }} | docker login docker.pkg.github.com --username ${GITHUB_ACTOR} --password-stdin &> /dev/null
          source .env
          docker pull docker.pkg.github.com/grantmacken/alpine-xqerl/xq:${GHPKG_VER} &> /dev/null
          echo -n ' - check available: '
          docker images | grep -oP 'alpine-xqerl'
          #echo -n ' - check available: '
          #docker images | grep -oP 'alpine-scour'
          #echo -n ' - check available: '
          #docker images | grep -oP 'alpine-zopfli'
          #echo -n ' - check available: '
          #docker images | grep -oP 'alpine-cmark-gfm'
      - name: Set up local bin
        run: |
          mkdir -p $HOME/.local/bin
          echo "$HOME/.local/bin" >> $GITHUB_PATH
          pushd $HOME/.local/bin && ln -s ${GITHUB_WORKSPACE}/bin/xq && popd
          which xq
      - name: run xqerl in container
        run: |
          printf %60s | tr ' ' '-' && echo
          echo '> make up'
          make up
          printf %60s | tr ' ' '-' && echo
      - name:  put XML documents into db as an document node items
        run: |
          echo '> xq put example.com/examples/works.xml'
          xq put example.com/examples/works.xml
          printf %60s | tr ' ' '-' && echo
      - name: Stop running xqerl
        run: | 
          make down
          printf %60s | tr ' ' '-' && echo
#     - name: xq delete
#       run: |
#         echo '- xq delete {db-path} deletes XDM item from the db'
#         echo '> xq delete example.com/examples/employees.xml'
#         bin/xq delete example.com/examples/employees.xml
#         printf %60s | tr ' ' '-' && echo
#     - name: xq link
#       run: |
#         echo ' - xq CRUD database actions [ put list available get delete link  ] '
#         echo ' - all *static asset* sources are located in the "./src/static-assets/" directory'
#         echo ' - `xq link {domain} {path}` will store db link to a static asset file'
#         echo '> xq link example.com icons/article.svg'
#         xq link example.com icons/article.svg
#         echo '> xq link example.com icons/article.svg'
#         xq link example.com icons/article.svg
#         echo '> xq link example.com icons/note.svg'
#         xq link example.com icons/note.svg
